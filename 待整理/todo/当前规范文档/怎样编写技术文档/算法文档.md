# 算法文档

算法文档的一些写作原则:

1. 算法中不要包含具体的代码实现，应该用实现无关的“自然语言”。文档中偶尔可以直接用代码来表达算法。但是代码应该经过简化，删除错误判断等描述算法原理无关的细节。
2. 算法文档需要达到的效果: 用户不用阅读代码，通过阅读算法文档就可以理解系统的行为，可以对着文档来分析某个问题产生的原因。

算法设计文档一般包含以下几个部分:

* 算法目标
* 变量定义
* 算法流程

算法中的分支执行可以写成

对 xxx 进行判断：

* 如果 case 1, 那么...
* 如果 case 2, 那么...
* 如果 case 3, 那么...

## 例子

### 连续多个 Create file 事件的聚合算法

**算法目标**

现在用户一次上传多个文件会生成大量的 create file 事件，影响 activity 功能的实用性。需要把这些事件聚合成一个事件。

**变量定义**

* actuallyEvents: 一个列表，存储处理后的事件
* multiFilesActivity: 一个聚合事件，multiFilesActivity != null 表示在聚合状态

**算法流程**

遍历原始事件列表，判断是否在聚合状态

* 如果在聚合状态，那么更新聚合计数，并判断下一事件是否符合聚合条件
  * 如果符合聚合条件，那么进入下一个循环。
  * 否则将聚合事件放到新的事件列表 (actuallyEvents) 中，同时退出聚合模式 (multiFilesActivity 设为 null)。
* 如果不在聚合状态，判断是否符合聚合条件
  * 如果符合聚合条件，进入聚合模式 (创建新 multiFilesActivity 对象)，同时更新聚合计数。
  * 否则直接把事件放到 actuallyEvents 中。



## 练习

#### 邮件内容引用表格文本算法

##### 算法目标

用户希望发送邮件时直接使用界面其他列的数据，需要根据邮件内容，获取对应列中单元格的数据，插入邮件内容中。

##### 变量定义

- messageContent: 一个字符串，默认用户输入的邮件内容
- rowID 一个字符串，用来获取邮件对应的行

##### 算法流程

- 新建文本替换对象

- 遍历邮件内容，如果存在一组大括号，获取大括号之间的字符串，作为预设列名。将列名作为对象的键保存。
- 遍历文本替换对象，获取不同的列名，通过 SDK 中 getColumnByName 获取到列
  - 如果列不存在，设置键值为空数组
  - 如果列存在，根据行数据，获取这一列对应的单元格的值，并格式化后转换成字符串，设置为键值
  - 使用正则替换原始邮件内容中的大括号
- 特殊：如果大括号不匹配，例如 {test{test}，那么按照第一个左括号和第一个右括号，进行获取列名为 test{test

