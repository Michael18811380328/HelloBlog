# 第三方库笔记 
 
## 0029 vue中的双向绑定和数据流


早期 vue就是双向绑定组件，实现数据通信

最新的版本当中，已经变成了单向数据流，就是从父组件到子组件进行单向的数据传递。



   
## 0047 双向绑定和vuex是否冲突


vuex 是 vue 的状态管理工具

这个涉及的不多，这个实际上是不冲突的（新版本使用单向数据流，取消了双向绑定的情况）

可以在时间回调当中使用 mutation 修改state的值，或者是用set的双向绑定来计算属性



   
## 0103 多语言网站应该怎么处理


翻译模块 react-intl 处理 i18n

时间模块（dayjs moment）这里需要根据当地时间处理时区转换

使用一些数字和格式的模块 格式化数字和货币



   
## 0140 绘图库 echarts 学习


详见技术排期表

常用的几个类型，基本的配置（两个轴，数据，标签，图例等）柱状图（条形图）、折线图、饼图、散点图；以蜡烛图为例，设置一个比较复杂的应用实例。



   
## 0168 你用过哪些UI组件库，具体有哪个常用的组件？


这个问题是第三方组件层级

PC端主要是 reactstrap 举出其他主要的常用的组件

移动端主要是 ant Design mobile，现在已经到 5.x.x 参考 <https://mobile.ant.design/zh/components/button> 

分类：

用户交互组件：表单，输入框，按钮 Form Input Button Switch Checkbox

展示信息组件：Nav Card Swiper(走马灯)

提示组件：Toaster Tooltip Dialog Popover

其他特殊：图标，日历，进度条



   
## 0174 有什么可视化的工具和库


蚂蚁集团出的 charts g2

AntV 3.0 已全新升级，主要包含 G2、G6、F2、L7 以及一套完整的图表使用和设计规范 <https://antv.vision/zh> 

自己的实践：若干统计图表

条形图，折线图，饼图，蜡烛图，以及各种组合



   
## 0169 你自己的项目里边有哪些主要的组件和界面，包括什么样的架构？


这个主要是项目的页面和广度

1、文件管理项目 seafile 前端 React 文件结构

2、表格管理项目 seatable 前端 React 表格结构

3、小说编辑器 React全栈

4、校园网小程序 小程序

？



   
## 0178 react-dnd 实现拖拽的基本思路


基于项目中的 dnd 版本，2.6.0 版本

react-dnd 是一个支持 react 拖动库，使用了高阶组件和 redux 等设计思路，基本使用

1、设置最外层一个可拖动对象 html5DragLayer 拖动上下文

```
import { DragDropContext } from 'react-dnd';
import HTML5Backend from 'react-dnd-html5-backend';

export default DragDropContext(HTML5Backend);

```

html5DragDropContext(DropTarget) 包裹被拖动组件

2、主要函数：

dragSource：拖动的源，包括 beginDrag endDrag isDragging 三个对象，用来表示拖动不同阶段返回的值（当前拖动的内容，当前拖动的索引等）

dropTarget：释放对象，包括 drop 函数，通过 monitor.getItem 获取拖动的对象，执行对应操作

dragCollect：拖动的函数收集，类似 map States to Props 函数，把外部的函数映射到内部

dropCollect：释放的函数收集，同上，把释放的函数映射到组件内部

```
DropTarget('ViewStructure', dropTarget, dropCollect) (DragSource('ViewStructure', dragSource, dragCollect)(Item));

```



   
## 0253 axios 版本问题


升级 axios 版本问题

造成 jest 单元测试不通过的解决



本质原因：早期 axios 是 common-js 打包的，新版本没有支持 common-js 打包。Jest 执行单元测试在 node 环境下，不支持 es6语法，所以 import axios 就会报错。解决思路是，把 import 语法替换掉

```
moduleNameMapper: {
	'^axios$': require.resolve('axios'),
},

```

就是 module name 映射关系，把 import axios 变成 require.resolve('axios') 这样 Jest 就可以测试通过了



其他参考 https\://juejin.cn/post/6898738304754286605



   
## 0254 HTMLtoCanvas


HTMLtoCanvas 第三方库学习

```
canvas.toDataUrl('image/png', 1.0)  

```

配置：

allowTaint

taintTest

allowCORS

使用场景：

统计中 canvas 导出生成 PNG，主页看板娘的 canvas 拍照显示成 png 的功能。



   
## 0259 reactstrap 中 popover 点击外部问题


Popover 点击问题：原来通过 event.target.className === 'xxx' 判断，这样如果改变了类名，那么这里判断失效。

最好的办法是 dom.contains() 判断 dom 之间的包含关系，至少使用 includes('xxx') 的形式，避免类名变化造成的问题。如果牵头的层级比较多，这个就可能造成一个事件在树节点中依次传，性能比较差。

这样性能可能不太好。最好的办法是类似对话框，增加一个后面的遮挡，这个层监听点击事件。



   
## 0263 raf 库


### raf 库

requestAnimationFrame 的 polyfill（简化操作，处理浏览器兼容性）

<https://github.com/chrisdickinson/raf#readme> 

```javascript
const raf = require('raf')

function callback() {
  // animation function
}

var handle = raf(callback);
handle();
raf.cancel(handle);

```



   
## 0267 canvas ——实现刮刮乐


前端刮刮乐的实现，canvas API，先创建一个矩形灰色区域，然后监听鼠标点击事件，绘制新的区域，和第一个区域求差值即可，鼠标按下后，监听鼠标移动事件。鼠标抬起后，清空鼠标移动事件。关键是 canvas 的属性和 API。

<https://juejin.cn/post/7142839691203575838> 

<https://blog.csdn.net/qq_44907926/article/details/119881880> 



```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>中奖啦</title>
  <style>
    h1 {
        text-align: center;
    }
    #container {
        width: 400px;
        height: 100px;
        position: relative;
        left: 50%;
        transform: translate(-50%, 0);
    }

    .back, canvas {
        position: absolute;
        width: 400px;
        height: 100px;
        left: 0;
        top: 0;
        text-align: center;
        font-size: 25px;
        line-height: 100px;
        color: deeppink;
    }

  </style>
</head>
<body>
  <h1>刮刮乐</h1>
  <div id="container">
      <div class="back">二等奖</div>
      <!-- 如果背景是图片，那么这里再加一个图片 -->
      <canvas id="canvas" width="400" height="100"></canvas>
  </div>

  <script>
    // 避免选中背景的文字（二等奖）
    document.addEventListener("selectstart", function (e) {
        e.preventDefault();
    });

    // 前景灰色蒙版 canvas
    let canvas = document.querySelector("#canvas");
    let ctx = canvas.getContext('2d');
    ctx.fillStyle = 'darkgray';
    ctx.fillRect(0, 0, 400, 100);

    // 判断当前状态是否点击
    let isDraw = false;
    canvas.onmousedown = function () {
        isDraw = true;
    }

    let containerDom = document.querySelector('#container');

    canvas.onmousemove = function (e) {
        // 鼠标按下时，刮奖
        if (isDraw) {
            let x = e.pageX - containerDom.offsetLeft + containerDom.offsetWidth / 2;
            let y = e.pageY - containerDom.offsetTop;
            ctx.beginPath();
            // 绘制圆形：xy 是圆心坐标，r 是半径，0, 2 * Math.PI 是开始的角度和结束的角度
            ctx.arc(x, y, 30, 0, 2 * Math.PI);
            // 关键： globalCompositeOperation = type 这个属性设定了在画新图形时采用的遮盖策略
            // 具体属性参考：https://www.jianshu.com/p/ff425bfa6f41
            ctx.globalCompositeOperation = 'destination-out';
            ctx.fill();
            ctx.closePath();
        }
    }

    document.onmouseup = function () {
        isDraw = false;
    }

    // 中奖情况
    let arr = [
        { content: '一等奖：一个大嘴巴子', p: 0.1 },
        { content: '二等奖：两个大嘴巴子', p: 0.2 },
        { content: '三等奖：三个大嘴巴子', p: 0.3 }
    ];
    let tmp = Math.random();
    let backImageDom = document.querySelector('.back');
    if (tmp < arr[0].p) {
        backImageDom.innerHTML = arr[0].content;
    } else if (tmp < arr[1].p) {
        backImageDom.innerHTML = arr[1].content;
    } else if (tmp < arr[2].p) {
        backImageDom.innerHTML = arr[2].content;
    }
  </script>
</body>
</html>

```



   
## 0287 react-i18n fallbackLng 是什么


配置项设置了 fallBackLng 表示备用语言，就是主要翻译的语言不显示时，使用备用语言显示。

也造成了界面中加载了两种语言，可能多加载 100 kb 的资源。

![](https://cloud.seatable.cn/workspace/32/asset/e82c7317-556e-45c4-8b5d-092331cd8977/images/auto-upload/image-1699076150941.png)

![](https://cloud.seatable.cn/workspace/32/asset/e82c7317-556e-45c4-8b5d-092331cd8977/images/auto-upload/image-1699076156369.png)



   
## 0293 jsdom 模拟 node 环境下 window


需求：

node 环境下测试，需要使用全局变量 window ，但是node没有window只有global对象，所以需要这个第三方库模拟虚拟 dom 完成一些测试。

部分项目的测试文件中使用到了window.app，在jest测试中默认情况下是在Node.js环境中运行的，而window在Node.js中未定义，会报错，这里应该使用 jsdom 来手动的创建一下window,  

```javascript
import { JSDOM } from 'jsdom';

const { window } = new JSDOM('<!doctype html><html><body></body></html>');

global.window = window; 

```

官方链接：<https://www.npmjs.com/package/jsdom> 

官方案例

```
const jsdom = require("jsdom");

const { JSDOM } = jsdom;
const dom = new JSDOM(`<!DOCTYPE html><p>Hello world</p>`);
console.log(dom.window.document.querySelector("p").textContent); // "Hello world"

```



   
## 0303 lerna.js


<https://www.npmjs.com/package/lerna> 

主要功能：将多个依赖包完美的组合在一个引用中。Lerna is a tool that optimizes the workflow around managing multi-package repositories with git and npm.

实际项目中没有使用，了解即可



  