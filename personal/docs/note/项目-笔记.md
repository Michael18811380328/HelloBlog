# 项目笔记 
 
## 0348 断点续传






主要逻辑：文件切片——上传切片——合并切片——验证切片。

前端浏览器读取文件后，把文件切片后，每一个片段分片上传（滑动窗口算法），然后后端接收到切片后，返回当前已经上传的文件大小，然后把切片放在硬盘的临时目录下。后端检测全部上传后，拼接成完整的大文件，然后把文件路径和成功信息返回给前端。

特殊处理：如果某个切片没有上传到（丢包），那么前端需要循环上传没有成功上传的切片。如果中途网络中断，那么就暂停上传进程。等网络恢复后，再次上传，就实现了断点续传。

适应于大于10M小于1G的文件。超过1G的文件，可能浏览器无法读取到内存中。

后端 Java 实现：<https://juejin.cn/post/7266265543412351030> 

后端 express 实现：<https://juejin.cn/post/7233613362888966205> 



   
## 0357 评论框如何支持插入图片


Table 中的做法是：

创建一个 div 富文本编辑器，然后插入对应的图片节点，协作人节点。

然后删除时，可以删除对应的节点。这样也支持复制粘贴图片上传，后续可以写个技术文档。content=editable

主要步骤：编辑HTML、提交(转义)、发送到服务器、请求返回本地、渲染只读的HTML

编辑内容如下

```
test <img src=\"https://2024-02/bird.jpeg\" height=\"60\"> @foo

```

渲染评论

```
dangerouslySetInnerHTML={{ __html: commentContent }}

"rest @foo <img src=\"https://test.png\" height=\"60\"> ",

```



  