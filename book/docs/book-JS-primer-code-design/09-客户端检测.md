# 09-客户端检测

客户端检测：客户端检测浏览器并兼容；实际使用不多

早期各种浏览器和版本众多，各种兼容性问题层出不穷，所以需要做客户端监测，处理这部分兼容性问题。如果开发基于主流的 Chrome 最新版，不考虑兼容历史浏览器，客户端检测做的就比较少了。目前项目中，需要检测 MAC 还是 WIndows，移动端，微信内置浏览器这几个（其他浏览器检测不多）

原则：优先使用通用的方法，不到万不得已，不要写兼容的代码（其他的算法或者设计也是这样）

检测方法：

- 能力检测
- 怪癖检测
- 浏览器检测

## 能力监测

不是识别具体的浏览器，而是识别浏览器是否有某个 API。只要判断浏览器是否支持某个 API，就给出解决方案。

注意：一个能力和另一个能力不一定匹配。用哪个能力就检测哪一个能力。

~~~js
function isHostMethod(obj, property) {
  var t = typeof obj[property];
  return t !== 'function' ||
    (!!(t == 'object' && object[property])) || 
    t == 'unknown';
}
~~~

## 怪癖检测

检测浏览器存在什么特殊行为（例如 Safari 3 会枚举被隐藏的属性）

~~~js
var hasEnumShadowQuick = function() {
  var o = {
    toString: function() {}
  };
  var count = 0;
  for (var prop in o) {
    if (prop == 'toString') {
      conut++;
    }
  }
  return count > 1;
}();
~~~

## 用户代理检测

电子欺骗：浏览器通过在用户代理中加入错误的信息，来欺骗服务器（例如爬虫模拟浏览器发送请求）

用户代理种类繁多，UserAgent 可以识别内核版本、浏览器种类、操作系统、操作系统的具体版本，移动设备，游戏设别等。小公司通常不会处理各种各样的用户代理。详细代码100 行，用时再找。





